var insts = [{
  nomi: "Samarqand Davlat Tibbiyot Instituti",
  otmID: 'sammi',
  yunalishlar: [
    {
      mvdir: 5510100.0,
      nomi: "Davolash ishi",
      gr_k: 24,
      con_k: 140,
      olimp: 0
    },
    {
      mvdir: 5510200.0,
      nomi: "Pediatriya ishi",
      gr_k: 25,
      con_k: 100,
      olimp: 0
    },
    {
      mvdir: 5510300.0,
      nomi: "Tibbiy profilaktika ishi",
      gr_k: 10,
      con_k: 30,
      olimp: 0
    },
    {
      mvdir: 5510400.0,
      nomi: "Stomatologiya (yoâ€˜nalishlar boâ€˜yicha)",
      gr_k: 40,
      con_k: 40,
      olimp: 0
    },
    {
      mvdir: 5510500.0,
      nomi: "Farmatsiya (turlari boâ€˜yicha)",
      gr_k: 25,
      con_k: 30,
      olimp: 0
    },
    {
      mvdir: 5510900.0,
      nomi: "Tibbiy-biologik ish",
      gr_k: 4,
      con_k: 8,
      olimp: 0
    },
    {
      mvdir: 5511100.0,
      nomi: "Xalq tabobati ",
      gr_k: 7,
      con_k: 8,
      olimp: 0
    }
  ],
}, {
  nomi: "SamDU",
  otmID: "samdu",
  yunalishlar: [
    {
      mvdir: 5140100.0,
      nomi: "Biologiya (turlari boâ€˜yicha)",
      gr_k: 8,
      con_k: 40,
      olimp: 0
    },
    {
      mvdir: 5320500.0,
      nomi: "Biotexnologiya (tarmoqlar boâ€˜yicha)",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5410100.0,
      nomi: "Agrokimyo va agrotuproqshunoslik",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5410300.0,
      nomi: "Oâ€˜simliklarni himoya qilish (ekin turlari boâ€˜yicha)",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5411000.0,
      nomi: "Mevachilik va uzumchilik",
      gr_k: 10,
      con_k: 15,
      olimp: 0
    },
    {
      mvdir: 5411600.0,
      nomi: "Sabzavotchilik, polizchilik va kartoshkachilik",
      gr_k: 10,
      con_k: 15,
      olimp: 0
    },
    {
      mvdir: 5411700.0,
      nomi: "Issiqxona xoâ€˜jaligini tashkil etish va yuritish",
      gr_k: 10,
      con_k: 15,
      olimp: 0
    },
    {
      mvdir: 5630100.0,
      nomi: "Ekologiya va atrof-muhit muhofazasi (tarmoqlar va sohalar boâ€˜yicha)",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5140100220.0,
      nomi: "Biologiya (turlari boâ€˜yicha) (Nurobod tumani)",
      gr_k: 4,
      con_k: 0,
      olimp: 0
    },
    {
      mvdir: 5140100225.0,
      nomi: "Biologiya (turlari boâ€˜yicha) (Qo`shrabot tumani)",
      gr_k: 3,
      con_k: 0,
      olimp: 0
    },
    {
      mvdir: 5140500220.0,
      nomi: "Kimyo (turlari boâ€˜yicha) (Nurobod tumani)",
      gr_k: 8,
      con_k: 0,
      olimp: 0
    },
    {
      mvdir: 5140500225.0,
      nomi: "Kimyo (turlari boâ€˜yicha) (Qo`shrabot tumani)",
      gr_k: 5,
      con_k: 0,
      olimp: 0
    }
  ]
}, {
  nomi: "Samarqand vetereaneriya va meditsina instituti",
  otmID: 'vet',
  yunalishlar: [
    {
      mvdir: 5140100.0,
      nomi: "Biologiya (turlari boâ€˜yicha)",
      gr_k: 8,
      con_k: 40,
      olimp: 0
    },
    {
      mvdir: 5320500.0,
      nomi: "Biotexnologiya (tarmoqlar boâ€˜yicha)",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5410100.0,
      nomi: "Agrokimyo va agrotuproqshunoslik",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5410300.0,
      nomi: "Oâ€˜simliklarni himoya qilish (ekin turlari boâ€˜yicha)",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5411000.0,
      nomi: "Mevachilik va uzumchilik",
      gr_k: 10,
      con_k: 15,
      olimp: 0
    },
    {
      mvdir: 5411600.0,
      nomi: "Sabzavotchilik, polizchilik va kartoshkachilik",
      gr_k: 10,
      con_k: 15,
      olimp: 0
    },
    {
      mvdir: 5411700.0,
      nomi: "Issiqxona xoâ€˜jaligini tashkil etish va yuritish",
      gr_k: 10,
      con_k: 15,
      olimp: 0
    },
    {
      mvdir: 5630100.0,
      nomi: "Ekologiya va atrof-muhit muhofazasi (tarmoqlar va sohalar boâ€˜yicha)",
      gr_k: 15,
      con_k: 35,
      olimp: 0
    },
    {
      mvdir: 5140100220.0,
      nomi: "Biologiya (turlari boâ€˜yicha) (Nurobod tumani)",
      gr_k: 4,
      con_k: 0,
      olimp: 0
    },
    {
      mvdir: 5140100225.0,
      nomi: "Biologiya (turlari boâ€˜yicha) (Qo`shrabot tumani)",
      gr_k: 3,
      con_k: 0,
      olimp: 0
    },
    {
      mvdir: 5140500220.0,
      nomi: "Kimyo (turlari boâ€˜yicha) (Nurobod tumani)",
      gr_k: 8,
      con_k: 0,
      olimp: 0
    },
    {
      mvdir: 5140500225.0,
      nomi: "Kimyo (turlari boâ€˜yicha) (Qo`shrabot tumani)",
      gr_k: 5,
      con_k: 0,
      olimp: 0
    }
  ]
}]


var userData = {}

var otms = []

var samduYunalish = []
var sammiYunalish = []
var vetYunalish = []

// commands
var commands = {
  exit:"âŒBekor qilish",
  register:"ğŸ“ƒ Ro'yxatdan o'tish",
  check:"ğŸ” Tekshirish",
  info:"ğŸ“– Ma'lumot",
  sendMessage:"ğŸ“¨ Xabar qoldirish",
}


const chunk = (arr, size) =>
  Array.from({ length: Math.ceil(arr.length / size) }, (v, i) =>
    arr.slice(i * size, i * size + size)
  );


for (let i = 0; i < insts.length; i++) {
  const otm = insts[i];
  otms.push(otm.nomi)
}

otms.push(commands.exit)
var OTMS = chunk(otms, 3)


for (let i = 0; i < insts[0].yunalishlar.length; i++) {
  const sammiItem = insts[0].yunalishlar[i];
  sammiYunalish.push(sammiItem.nomi)
}
sammiYunalish.push(commands.exit)


for (let i = 0; i < insts[1].yunalishlar.length; i++) {
  const samduItem = insts[1].yunalishlar[i];
  samduYunalish.push(samduItem.nomi)
}
samduYunalish.push(commands.exit)


for (let i = 0; i < insts[2].yunalishlar.length; i++) {
  const vetItem = insts[2].yunalishlar[i];
  vetYunalish.push(vetItem.nomi)
}
vetYunalish.push(commands.exit)


var samDuYunalish = chunk(samduYunalish, 2)
var samMiYunalish = chunk(sammiYunalish, 2)
var veTYunalish = chunk(vetYunalish, 2)



const TelegramBot = require('node-telegram-bot-api');

// replace the value below with the Telegram token you receive from @BotFather
const token = '5358446083:AAF0FxxdxJivuBQ5qOdzSwkJwr8vZxgiE-8';

// Create a bot that uses 'polling' to fetch new updates
const bot = new TelegramBot(token, { polling: true });


// Matches "/echo [whatever]"
bot.onText(/\/echo (.+)/, (msg, match) => {
  // 'msg' is the received Message from Telegram
  // 'match' is the result of executing the regexp above on the text content
  // of the message

  const chatId = msg.chat.id;
  const resp = match[1]; // the captured "whatever"

  // send back the matched "whatever" to the chat
  bot.sendMessage(chatId, resp);
});

bot.onText(/\/start/, (msg) => {
  bot.sendMessage(msg.chat.id, "Assalomu alaykum", {
    "reply_markup": {
      "keyboard": [["ğŸ“ƒ Ro'yxatdan o'tish", "ğŸ” Tekshirish"], ["ğŸ“– Ma'lumot"], ["ğŸ“¨ Xabar qoldirish"]]
    }
  });
})

bot.on('message', (msg) => {
  if (msg.text.toString().indexOf(commands.register) === 0) {
      bot.sendMessage(msg.chat.id, "Oliy ta'lim muassasasini tanlang", 
      {"reply_markup": {"keyboard": OTMS}
    })
  }
});



bot.on('message', (msg) => {
  var otmSd = "SamDU";
  if (msg.text.toString().indexOf(otmSd) === 0) {
    userData.otm = "SamDU"
      bot.sendMessage(msg.chat.id, "Yo'nalishni tanlang: ", {
      "reply_markup": {"keyboard": samDuYunalish}
    })
  }
});

bot.on('message', (msg) => {
  var otmSd = "Samarqand Davlat Tibbiyot Instituti";
  if (msg.text.toString().indexOf(otmSd) === 0) {
    userData.otm = "Samarqand Davlat Tibbiyot Instituti"
      bot.sendMessage(msg.chat.id, "Yo'nalishni tanlang: ", {
      "reply_markup": {"keyboard": samMiYunalish}
    })
  }
});

bot.on('message', (msg) => {
  var otmSd = "Samarqand vetereaneriya va meditsina instituti";
  if (msg.text.toString().indexOf(otmSd) === 0) {
    userData.otm = "Samarqand vetereaneriya va meditsina instituti"
      bot.sendMessage(msg.chat.id, "Yo'nalishni tanlang: ", {
      "reply_markup": {"keyboard": veTYunalish}
    })
  }
});



bot.on('message', (msg) => {
  if (msg.text.toString().indexOf(commands.exit) === 0) {
      bot.sendMessage(msg.chat.id, "ğŸ˜ Asosiy menu", {
      "reply_markup": {"keyboard": [["ğŸ“ƒ Ro'yxatdan o'tish", "ğŸ” Tekshirish"], ["ğŸ“– Ma'lumot"], ["ğŸ“¨ Xabar qoldirish"]]}
    })
  }
});


var allYunalish = []

for (let i = 0; i < insts.length; i++) {
  const elem = insts[i].yunalishlar;
  for (let i = 0; i < elem.length; i++) {
  const elemin = elem[i];
  allYunalish.push(elemin)
} 
  
}

bot.on('message', (msg) => {
  for (let i = 0; i < allYunalish.length; i++) {
  const elim = allYunalish[i];
  
  if (msg.text.toString() === elim.nomi) {
    userData.yunalish = elim
    bot.sendMessage(msg.chat.id, "Ismingizni ", {
      "reply_markup": {"keyboard": [["ğŸ“ƒ Ro'yxatdan o'tish", "ğŸ” Tekshirish"], ["ğŸ“– Ma'lumot"], ["ğŸ“¨ Xabar qoldirish"]]}
    })
  }
}
});

